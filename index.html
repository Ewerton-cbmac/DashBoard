<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Equipes</title>
    <style>
        /* (Mantido o mesmo CSS que vocÃª jÃ¡ tem) */
    </style>
</head>
<body>
    <h1>Equipes Ativas</h1>

    <!-- SeÃ§Ãµes para os status -->
    <div class="status-section">
        <div class="status-title status-em-base">ðŸŸ¢ Em Base</div>
        <div id="em-base" class="cards-container"></div>
    </div>

    <div class="status-section">
        <div class="status-title status-em-deslocamento">ðŸŸ¡ Em Deslocamento</div>
        <div id="em-deslocamento" class="cards-container"></div>
    </div>

    <div class="status-section">
        <div class="status-title status-em-acao">ðŸ”´ Em AÃ§Ã£o</div>
        <div id="em-acao" class="cards-container"></div>
    </div>

    <div class="status-section">
        <div class="status-title status-outros">âšª Outros</div>
        <div id="outros" class="cards-container"></div>
    </div>

    <script>
        // FunÃ§Ã£o que serÃ¡ chamada com os dados retornados pelo Google Apps Script
        function carregarDadosJSONP(dados) {
            console.log(dados);

            // Limpa os containers antes de adicionar novos cards
            document.getElementById("em-base").innerHTML = "";
            document.getElementById("em-deslocamento").innerHTML = "";
            document.getElementById("em-acao").innerHTML = "";
            document.getElementById("outros").innerHTML = "";

            // Processa os dados e cria os cards
            dados.forEach(equipe => {
                let status = equipe.status ? equipe.status.toLowerCase() : "outros";
                const statusMap = {
                    "em base": "em-base",
                    "em deslocamento": "em-deslocamento",
                    "em aÃ§Ã£o": "em-acao"
                };
                const statusId = statusMap[status] || "outros";

                const card = document.createElement("div");
                card.className = "card";

                // Campos sempre visÃ­veis
                let cardContent = `
                    <h2>${equipe.equipe}</h2>
                    <p><strong>Chefe:</strong> ${equipe.chefe || "N/A"}</p>
                    <p><strong>Motorista:</strong> ${equipe.motorista || "N/A"}</p>
                    <p><strong>Telefone:</strong> ${equipe.telefone_motorista || "N/A"}</p>
                    <p><strong>Bairro:</strong> ${equipe.bairro || "N/A"}</p>
                    <p><strong>Pessoas na Equipe:</strong> ${equipe.pessoas_por_equipe || "N/A"}</p>
                    <button class="toggle-btn" onclick="toggleDetalhes(this)">Ver mais</button>
                    <div class="detalhes">
                `;

                // Adiciona os outros detalhes ao card (exceto os que jÃ¡ estÃ£o visÃ­veis)
                for (const chave in equipe) {
                    if (!["equipe", "status", "chefe", "motorista", "telefone_motorista", "bairro", "pessoas_por_equipe"].includes(chave)) {
                        cardContent += `<p><strong>${formatarChave(chave)}:</strong> ${equipe[chave]}</p>`;
                    }
                }

                card.innerHTML = cardContent;
                document.getElementById(statusId).appendChild(card);
            });
        }

        // FunÃ§Ã£o para alternar a exibiÃ§Ã£o dos detalhes
        function toggleDetalhes(botao) {
            let detalhes = botao.nextElementSibling;
            if (detalhes.style.display === "none" || detalhes.style.display === "") {
                detalhes.style.display = "block";
                botao.textContent = "Ver menos";
            } else {
                detalhes.style.display = "none";
                botao.textContent = "Ver mais";
            }
        }

        // Formata as chaves para exibiÃ§Ã£o
        function formatarChave(chave) {
            return chave.replace(/_/g, " ").replace(/\b\w/g, letra => letra.toUpperCase());
        }

        // Cria uma tag <script> para carregar os dados via JSONP
        function carregarDados() {
            const script = document.createElement("script");
            script.src = "https://script.google.com/macros/s/AKfycbyJFF-G2SWHiYoY3rjIWHKJ-nxJqlakHKqgJF8INkAH5mpUGnPHVEzQIrQ8ZAIIYebF/exec?callback=carregarDadosJSONP";
            document.body.appendChild(script);
        }

        // Carrega os dados ao carregar a pÃ¡gina e a cada 10 segundos
        carregarDados();
        setInterval(carregarDados, 10000);
    </script>
</body>
</html>
